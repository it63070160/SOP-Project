<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ploikong Bookstore</title>
    <link href="./css/styles.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <script src="https://kit.fontawesome.com/d65ed2b465.js" crossorigin="anonymous"></script>
    <!-- vue script -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2.7.14/dist/vue.js"></script>
    <!-- axios -->
    <script src="https://cdn.jsdelivr.net/npm/axios@1.2.0/dist/axios.min.js"></script>
    <script type="text/javascript" src="../js/BookService.js"></script>
    <script type="text/javascript" src="../js/UserService.js"></script>
</head>
<body>
    <div id="app" class="container">
        <!-- Add Book Modal -->
        <div v-show="showAddBookModal" class="modal fade" :class="{ show: showAddBookModal, 'd-block': showAddBookModal }" id="addBookModal" tabindex="-1" aria-labelledby="addBookModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="addBookModalLabel">Add book</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" @click="closeAddBookModal"></button>
                    </div>
                    <div class="modal-body" style="text-align:left">
                        <div class="form-floating mb-3">
                            <input type="text" class="form-control" id="inputName" placeholder="Book Name" v-model="bookName" required>
                            <label for="inputName">Name</label>
                        </div>
                        <div class="form-floating mb-3">
                            <textarea class="form-control" placeholder="Book Description" id="floatingTextarea" v-model="bookDesc" required></textarea>
                            <label for="floatingTextarea">Description (can edit later)</label>
                        </div>
                        <div class="form-floating mb-3">
                            <select class="form-select" id="floatingSelect" aria-label="Book Type" v-model="bookType">
                              <option value="E-Book" selected>E-Book</option>
                              <option value="Book">Book</option>
                            </select>
                            <label for="floatingSelect">Type</label>
                        </div>
                        <div class="form-floating mb-3">
                            <input type="number" class="form-control" id="inputQuantity" min="1" value="1" v-model="bookQty" required>
                            <label for="inputQuantity">Quantity</label>
                        </div>
                        <div class="form-floating mb-3">
                            <input type="number" step="0.01" class="form-control" id="inputPrice" min="0.00" value="0.00" v-model="bookPrice" required>
                            <label for="inputPrice">Price</label>
                        </div>
                        <div class="form-floating mb-3">
                            <select class="form-select" id="floatingSelect" aria-label="Floating label select example" v-model="checkoutType">
                              <option value="Cash On Delivery" selected>Cash on Delivery</option>
                              <option value="Transfer" disabled>Transfer (Coming Soon)</option>
                            </select>
                            <label for="floatingSelect">Checkout</label>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" @click="addBook">Add</button>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" @click="closeAddBookModal">Close</button>
                    </div>
                </div>
            </div>
        </div>
        <h1 class="text-center">My Books <button class="btn btn-secondary circle-btn" data-bs-toggle="modal" data-bs-target="#addBookModal" @click="openAddBookModal"><i class="fa-solid fa-plus"></i></button></h1>
        <div class="table-responsive">
            <table class="table table-hover table-responsive" style="text-align: center;vertical-align: middle;">
                <thead>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Type</th>
                    <th>Quantity</th>
                    <th>Price</th>
                    <th>Checkout</th>
                    <th>Action</th>
                </thead>
                <tbody class="table-group-divider">
                    <tr v-for="book in myBooks" v-bind:key="book.bookId">
                        <td>{{book.bookId}}</td>
                        <td>{{book.bookName}}</td>
                        <td>{{book.bookType}}</td>
                        <td>{{book.bookQuantity}}</td>
                        <td>{{book.bookPrice}}à¸¿</td>
                        <td>{{book.checkOutType}}</td>
                        <td>
                            <button type="button" class="btn btn-primary" style="margin: 5px" data-bs-toggle="modal" data-bs-target="#infoModal" @click=""><i class="fa-solid fa-circle-info"></i></button>
                            <button type="button" class="btn btn-warning" style="margin: 5px"><i class="fa-regular fa-pen-to-square"></i></button>
                            <button type="button" class="btn btn-danger" style="margin: 5px"><i class="fa-solid fa-trash"></i></button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    
    <script>
        var app = new Vue({
            el: '#app',
            data: {
                message: "",
                userInfo: "",
                bookName: "",
                bookDesc: "",
                bookType: "E-Book",
                bookQty: 1,
                bookPrice: 0.00,
                checkoutType: "Cash On Delivery",
                ownerId: "",
                showAlert: false,
                showAddBookModal : false,
                checkUserInfo: {},
                error: false,
                myBooks: [],
                newBookInfo: {
                    bookName: "",
                    bookDescription: "",
                    bookType: "",
                    bookQuantity: 1,
                    bookPrice: 0,
                    checkOutType: ""
                }
            },
            methods:{
                getMyBooks(){
                    this.checkUserId()
                    getUserBooks(this.ownerId).then((response)=>{
                        this.myBooks = response.data
                    }).catch((e)=>{
                        alert("1You need to login")
                        localStorage.clear()
                        window.location.href = "./views/loginView.html"
                    })
                },
                addBook(){
                    this.newBookInfo = {
                        bookName: this.bookName,
                        bookDescription: this.bookDesc,
                        bookType: this.bookType,
                        bookQuantity: parseInt(this.bookQty),
                        bookPrice: parseFloat(this.bookPrice),
                        checkOutType: this.checkoutType,
                        ownerId: this.ownerId
                    }
                    addNewBook(this.newBookInfo).then((response)=>{
                        this.closeAddBookModal()
                        location.reload()
                    })
                },
                openAddBookModal(){
                    this.showAddBookModal = true;
                },
                closeAddBookModal(){
                    this.showAddBookModal = false
                },
                allowedCheck(check){
                    this.checkUserInfo = check
                    console.log(this.checkUserInfo)
                },
                checkUserId(){
                    if(localStorage.getItem("userInfo")!=null){
                        this.userInfo = JSON.parse(localStorage.getItem("userInfo"))
                        checkUser(this.userInfo).then((response)=>{
                            // if(response.data.userId==this.userInfo.userId){
                            //     console.log(response.data)
                            // }else{
                            //     alert("You need to login")
                            //     localStorage.clear()
                            //     window.location.href = "./views/loginView.html"
                            // }
                            this.allowedCheck(response.data)
                        }).catch((e)=>{
                            alert("2You need to login "+e)
                            // localStorage.clear()
                            // window.location.href = "./views/loginView.html"
                        })
                    }else{
                        alert("3You need to login")
                        // localStorage.clear()
                        // window.location.href = "./views/loginView.html"
                    }
                }
            },
            created() {
                this.checkUserId();
                // this.getMyBooks();
            }
        })
    </script>
</body>
</html>